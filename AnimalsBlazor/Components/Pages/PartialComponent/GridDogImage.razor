@using AnimalsBlazor.Components.Pages.PartialComponent
@using AnimalsBlazor.Services

@inject IDogService DogService
@inject IDialogService DialogService

@rendermode InteractiveServer

<MudItem class="d-flex">
    <MudText Typo="Typo.h3" GutterBottom="true">Escolha sua imagem:</MudText>
    <MudButton OnClick="CarregarImagens" Variant="Variant.Outlined" Color="Color.Primary">Aleatorizar</MudButton>
</MudItem>


@if (isLoading)
{
    <MudGrid Justify="Justify.Center" Class="mt-6">
        <MudItem xs="12" class="d-flex justify-center">
            <MudProgressCircular Color="Color.Primary" Indeterminate="true" />
        </MudItem>
    </MudGrid>
}
else
{
    <MudGrid Spacing="10" Justify="Justify.Center">
        @foreach (var imagem in Imagens)
        {
            <MudItem>
                <MudPaper Height="140px" Width="140px">
                    <MudButton OnClick="@(() => OpenDialogAsync(imagem))" Style="padding: 0">
                        <MudImage Src="@imagem" Height="140" Width="140" Alt="Random Dog" Elevation="25" Class="rounded-lg" />
                    </MudButton>
                </MudPaper>
            </MudItem>
        }
    </MudGrid>
}

<style>
    .my-custom-class {
        backdrop-filter: blur(10px);
    }
</style>

@code {
    private List<string> Imagens = new();
    public int cont = 12;
    private string? Imagem;
    private bool isLoading = false;

    protected override async Task OnInitializedAsync()
    {
        isLoading = true;
        await CarregarImagens();
        isLoading = false;
    }

    private async Task CarregarImagens()
    {
        isLoading = true;
        Imagens.Clear();

        for (int i = 0; i < cont; i++)
        {
            var imagem = await DogService.GetRandomDogImageAsync();
            {
                Imagens.Add(imagem!);
            }
        }

        isLoading = false;
    }

    private Task OpenDialogAsync(string imagem)
    {
        var parameters = new DialogParameters { ["Imagem"] = imagem };

        var options = new DialogOptions { BackgroundClass = "my-custom-class",};

        return DialogService.ShowAsync<DogImageDialog>("Deseja baixar essa imagem?", parameters, options);
    }
}